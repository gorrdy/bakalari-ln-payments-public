name: Weekly Bakalari LN Payout

on:
  # AUTOMATICK√ù PL√ÅN JE ZAKOMENTOV√ÅN! 
  # U≈æivatel√© si mus√≠ po nastaven√≠ Secrets tuto sekci odkomentovat (odstranit #)
#  schedule:
#    # Spou≈°tƒõn√≠ ka≈æd√© pondƒõl√≠ ve 12:00 UTC
#    - cron: "0 12 * * 1"
  workflow_dispatch: # Povoluje ruƒçn√≠ spu≈°tƒõn√≠

# GLOB√ÅLN√ç OPR√ÅVNƒöN√ç: contents: write je pro jistotu zachov√°no, ale kl√≠ƒçov√© je pou≈æit√≠ PAT
permissions:
  contents: write

jobs:
  payout:
    runs-on: ubuntu-latest
    
    env:
      # üöÄ KRITICK√Å ZMƒöNA: Pou≈æ√≠v√°me V√°≈° silnƒõj≈°√≠ PAT token pro p≈ô√≠stup k Variables
      GITHUB_TOKEN: ${{ secrets.GH_API_TOKEN }} 
      # --- BAKAL√Å≈òI SECRETS ---
      BAKALARI_BASE_URL: ${{ secrets.BAKALARI_BASE_URL }}
      BAKALARI_USERNAME: ${{ secrets.BAKALARI_USERNAME }}
      BAKALARI_PASSWORD: ${{ secrets.BAKALARI_PASSWORD }}
      # --- LNBITS SECRETS ---
      LNBITS_HOST: ${{ secrets.LNBITS_HOST }}
      LNBITS_WITHDRAW_KEY: ${{ secrets.LNBITS_WITHDRAW_KEY }}
      # --- SMTP SECRETS ---
      SMTP_HOST: ${{ secrets.SMTP_HOST }}
      SMTP_USER: ${{ secrets.SMTP_USER }}
      SMTP_PASS: ${{ secrets.SMTP_PASS }}
      NOTIFICATION_EMAIL: ${{ secrets.NOTIFICATION_EMAIL }}
      # --- VARIABLES (VARS) ---
      EXCHANGE_RATE_API_URL: ${{ vars.EXCHANGE_RATE_API_URL }}
      START_DATE: 2025-11-01
      REWARD_GRADE_1_CZK: ${{ vars.REWARD_GRADE_1_CZK }}
      REWARD_GRADE_2_CZK: ${{ vars.REWARD_GRADE_2_CZK }}
      REWARD_GRADE_3_CZK: ${{ vars.REWARD_GRADE_3_CZK }}
      REWARD_GRADE_4_CZK: ${{ vars.REWARD_GRADE_4_CZK }}
      REWARD_GRADE_5_CZK: ${{ vars.REWARD_GRADE_5_CZK }}

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install dependencies
        run: npm install

      - name: Run payout script
        run: node index.js
